{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PRD Adaptive Vertical Slice Plan",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "status",
    "complexity_assessment",
    "architecture_guardrails",
    "spine",
    "slices",
    "scoring",
    "top_risks",
    "debt_ledger",
    "slice_definition_of_done"
  ],
  "properties": {
    "status": {
      "type": "string",
      "enum": ["success", "needs_input", "failure"]
    },
    "complexity_assessment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["complexity_level", "why", "slice_count_range", "is_micro_prd"],
      "properties": {
        "complexity_level": {
          "type": "string",
          "enum": ["Small", "Medium", "Large", "Huge"]
        },
        "why": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "slice_count_range": {
          "type": "object",
          "additionalProperties": false,
          "required": ["min", "max"],
          "properties": {
            "min": { "type": "integer", "minimum": 1 },
            "max": { "type": "integer", "minimum": 1 }
          }
        },
        "is_micro_prd": { "type": "boolean" }
      }
    },
    "architecture_guardrails": {
      "type": "object",
      "additionalProperties": false,
      "required": ["module_map", "invariants", "enforcement_hooks"],
      "properties": {
        "module_map": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["module", "responsibility"],
            "properties": {
              "module": { "type": "string" },
              "responsibility": { "type": "string" }
            }
          }
        },
        "invariants": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "enforcement_hooks": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        }
      }
    },
    "spine": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "slices": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "slice_name",
          "user_outcome",
          "primary_persona",
          "owning_module",
          "touched_modules",
          "in_scope",
          "out_of_scope",
          "constraints",
          "end_to_end_surface",
          "architecture_notes",
          "failure_modes_fallback",
          "rollout_plan",
          "success_metrics",
          "key_risks_reduced"
        ],
        "properties": {
          "slice_name": { "type": "string" },
          "user_outcome": { "type": "string" },
          "primary_persona": { "type": "string" },
          "owning_module": { "type": "string" },
          "touched_modules": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["module", "why"],
              "properties": {
                "module": { "type": "string" },
                "why": { "type": "string" }
              }
            }
          },
          "in_scope": { "type": "array", "items": { "type": "string" } },
          "out_of_scope": { "type": "array", "items": { "type": "string" } },
          "constraints": { "type": "array", "items": { "type": "string" } },
          "end_to_end_surface": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "ui_ux_changes",
              "api_contract_changes",
              "data_state_changes",
              "permissions_authz_changes",
              "telemetry_observability"
            ],
            "properties": {
              "ui_ux_changes": {
                "type": "array",
                "items": { "type": "string" }
              },
              "api_contract_changes": {
                "type": "array",
                "items": { "type": "string" }
              },
              "data_state_changes": {
                "type": "array",
                "items": { "type": "string" }
              },
              "permissions_authz_changes": {
                "type": "array",
                "items": { "type": "string" }
              },
              "telemetry_observability": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          },
          "architecture_notes": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "boundary_rule_respected",
              "acl_adapter_needed",
              "temporary_seam"
            ],
            "properties": {
              "boundary_rule_respected": { "type": "string" },
              "acl_adapter_needed": { "type": "string" },
              "temporary_seam": { "type": "string" }
            }
          },
          "failure_modes_fallback": {
            "type": "array",
            "items": { "type": "string" }
          },
          "rollout_plan": {
            "type": "object",
            "additionalProperties": false,
            "required": ["flag", "gating", "rollback"],
            "properties": {
              "flag": { "type": "string" },
              "gating": {
                "type": "array",
                "items": { "type": "string" }
              },
              "rollback": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          },
          "success_metrics": {
            "type": "array",
            "items": { "type": "string" }
          },
          "key_risks_reduced": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    },
    "scoring": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "slice_name",
          "customer_value_now",
          "learning_value",
          "technical_risk_reduction",
          "gtm_enablement",
          "sequence_order",
          "stability_gate"
        ],
        "properties": {
          "slice_name": { "type": "string" },
          "customer_value_now": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
          },
          "learning_value": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
          },
          "technical_risk_reduction": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
          },
          "gtm_enablement": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
          },
          "sequence_order": { "type": "integer", "minimum": 1 },
          "stability_gate": { "type": "string" }
        }
      }
    },
    "top_risks": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["risk", "addressed_by_slice"],
        "properties": {
          "risk": { "type": "string" },
          "addressed_by_slice": { "type": "string" }
        }
      }
    },
    "debt_ledger": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["debt", "why", "risk", "payoff"],
        "properties": {
          "debt": { "type": "string" },
          "why": { "type": "string" },
          "risk": { "type": "string" },
          "payoff": { "type": "string" }
        }
      }
    },
    "slice_definition_of_done": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "notes": { "type": "array", "items": { "type": "string" } }
  }
}
